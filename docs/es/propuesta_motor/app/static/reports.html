<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes - Motor Contable</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/sidebar-collapsed.css">
    <style>
        .report-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }
        .report-card {
            background-color: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            padding: var(--spacing-lg);
            cursor: pointer;
            transition: all var(--transition-normal);
            border: 2px solid transparent;
        }
        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }
        .report-card.selected {
            border-color: var(--primary-color);
            background-color: #f0f8ff;
        }
        .report-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }
        .report-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }
        .report-description {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        .report-preview {
            background-color: #f5f5f5;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            min-height: 400px;
            overflow: auto;
        }
        .period-selector {
            display: flex;
            gap: var(--spacing-md);
            align-items: flex-end;
        }
        .period-preset {
            display: flex;
            gap: var(--spacing-sm);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <button class="menu-toggle" id="menuToggle">☰</button>
            <div class="navbar-brand">
                <h1>Motor Contable</h1>
            </div>
            <div class="navbar-actions">
                <div class="search-box">
                    <input type="text" placeholder="Buscar reporte..." id="searchInput">
                    <button type="button" class="search-btn">🔍</button>
                </div>
                <div class="user-menu">
                    <img src="../img/avatar.png" alt="Usuario" class="user-avatar">
                    <span>Juan Pérez</span>
                    <span class="dropdown-arrow">▼</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="dashboard.html"><span class="menu-icon">📊</span><span class="menu-text">Dashboard</span></a></li>
                    <li><a href="vouchers_list.html"><span class="menu-icon">📄</span><span class="menu-text">Comprobantes</span></a></li>
                    <li><a href="journal_entries.html"><span class="menu-icon">📚</span><span class="menu-text">Asientos</span></a></li>
                    <li><a href="accounts_chart.html"><span class="menu-icon">🏦</span><span class="menu-text">Plan de Cuentas</span></a></li>
                    <li><a href="templates.html"><span class="menu-icon">📋</span><span class="menu-text">Templates</span></a></li>
                    <li class="active"><a href="reports.html"><span class="menu-icon">📈</span><span class="menu-text">Reportes</span></a></li>
                    <li><a href="dsl_editor.html"><span class="menu-icon">⚙️</span><span class="menu-text">Reglas DSL</span></a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h2>Reportes Contables</h2>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="showScheduleModal()">
                        ⏰ Programar Reporte
                    </button>
                    <button class="btn btn-secondary" onclick="showSavedReports()">
                        💾 Reportes Guardados
                    </button>
                </div>
            </div>

            <!-- Report Selection -->
            <div class="card">
                <div class="card-header">
                    <h3>📋 Seleccione un Reporte</h3>
                </div>
                <div class="card-body">
                    <div class="report-cards" id="reportCards">
                        <div class="report-card" data-report="balance_general" onclick="selectReport('balance_general')">
                            <div class="report-icon">⚖️</div>
                            <div class="report-title">Balance General</div>
                            <div class="report-description">Estado de situación financiera con activos, pasivos y patrimonio</div>
                        </div>
                        <div class="report-card" data-report="estado_resultados" onclick="selectReport('estado_resultados')">
                            <div class="report-icon">💰</div>
                            <div class="report-title">Estado de Resultados</div>
                            <div class="report-description">Ingresos, gastos y utilidad del período</div>
                        </div>
                        <div class="report-card" data-report="libro_diario" onclick="selectReport('libro_diario')">
                            <div class="report-icon">📚</div>
                            <div class="report-title">Libro Diario</div>
                            <div class="report-description">Registro cronológico de todos los asientos contables</div>
                        </div>
                        <div class="report-card" data-report="libro_mayor" onclick="selectReport('libro_mayor')">
                            <div class="report-icon">📖</div>
                            <div class="report-title">Libro Mayor</div>
                            <div class="report-description">Movimientos detallados por cuenta contable</div>
                        </div>
                        <div class="report-card" data-report="balance_comprobacion" onclick="selectReport('balance_comprobacion')">
                            <div class="report-icon">✅</div>
                            <div class="report-title">Balance de Comprobación</div>
                            <div class="report-description">Saldos de todas las cuentas para verificación</div>
                        </div>
                        <div class="report-card" data-report="auxiliar_terceros" onclick="selectReport('auxiliar_terceros')">
                            <div class="report-icon">👥</div>
                            <div class="report-title">Auxiliar de Terceros</div>
                            <div class="report-description">Movimientos y saldos por cliente o proveedor</div>
                        </div>
                        <div class="report-card" data-report="flujo_efectivo" onclick="selectReport('flujo_efectivo')">
                            <div class="report-icon">💸</div>
                            <div class="report-title">Flujo de Efectivo</div>
                            <div class="report-description">Entradas y salidas de efectivo del período</div>
                        </div>
                        <div class="report-card" data-report="estado_cambios" onclick="selectReport('estado_cambios')">
                            <div class="report-icon">🔄</div>
                            <div class="report-title">Estado de Cambios en el Patrimonio</div>
                            <div class="report-description">Variaciones en las cuentas patrimoniales</div>
                        </div>
                        <div class="report-card" data-report="notas_financieras" onclick="selectReport('notas_financieras')">
                            <div class="report-icon">📝</div>
                            <div class="report-title">Notas a los Estados Financieros</div>
                            <div class="report-description">Revelaciones y políticas contables</div>
                        </div>
                        <div class="report-card" data-report="reporte_fiscal" onclick="selectReport('reporte_fiscal')">
                            <div class="report-icon">🏛️</div>
                            <div class="report-title">Reportes Fiscales</div>
                            <div class="report-description">Información para declaraciones tributarias</div>
                        </div>
                        <div class="report-card" data-report="indicadores" onclick="selectReport('indicadores')">
                            <div class="report-icon">📊</div>
                            <div class="report-title">Indicadores Financieros</div>
                            <div class="report-description">Ratios y métricas de análisis financiero</div>
                        </div>
                        <div class="report-card" data-report="personalizado" onclick="selectReport('personalizado')">
                            <div class="report-icon">⚙️</div>
                            <div class="report-title">Reporte Personalizado</div>
                            <div class="report-description">Cree reportes a medida con DSL</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Configuration -->
            <div class="card" id="reportConfig" style="display: none;">
                <div class="card-header">
                    <h3>⚙️ Configuración del Reporte</h3>
                </div>
                <div class="card-body">
                    <form id="reportForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Organización</label>
                                <select class="form-control" id="organization">
                                    <option value="org-001">Empresa Demo S.A.S</option>
                                    <option value="org-002">Sucursal México</option>
                                    <option value="org-003">Filial Chile</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Período</label>
                                <div class="period-preset">
                                    <button type="button" class="btn btn-sm" onclick="setPeriod('month')">Mes Actual</button>
                                    <button type="button" class="btn btn-sm" onclick="setPeriod('quarter')">Trimestre</button>
                                    <button type="button" class="btn btn-sm" onclick="setPeriod('year')">Año</button>
                                    <button type="button" class="btn btn-sm" onclick="setPeriod('custom')">Personalizado</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="period-selector" id="periodSelector">
                            <div class="form-group">
                                <label>Fecha Desde</label>
                                <input type="date" class="form-control" id="dateFrom" value="2024-01-01">
                            </div>
                            <div class="form-group">
                                <label>Fecha Hasta</label>
                                <input type="date" class="form-control" id="dateTo" value="2024-01-31">
                            </div>
                            <div class="form-group">
                                <label>Comparar con</label>
                                <select class="form-control" id="compareWith">
                                    <option value="">No comparar</option>
                                    <option value="previous_period">Período anterior</option>
                                    <option value="previous_year">Año anterior</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-grid" id="additionalOptions">
                            <!-- Additional options will be added dynamically based on report type -->
                        </div>

                        <div class="form-group">
                            <label>Formato de Salida</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="format" value="preview" checked>
                                    Vista Previa
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="format" value="pdf">
                                    PDF
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="format" value="excel">
                                    Excel
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="format" value="csv">
                                    CSV
                                </label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="resetReport()">
                                Cancelar
                            </button>
                            <button type="button" class="btn btn-primary" onclick="generateReport()">
                                📊 Generar Reporte
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Report Preview -->
            <div class="card" id="reportPreview" style="display: none;">
                <div class="card-header">
                    <h3 id="reportTitle">Vista Previa del Reporte</h3>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-secondary" onclick="printReport()">🖨️ Imprimir</button>
                        <button class="btn btn-sm btn-secondary" onclick="exportReport()">📥 Exportar</button>
                        <button class="btn btn-sm btn-secondary" onclick="saveReport()">💾 Guardar</button>
                        <button class="btn btn-sm btn-secondary" onclick="emailReport()">📧 Enviar</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="report-preview" id="reportContent">
                        <!-- Report content will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Recent Reports -->
            <div class="card">
                <div class="card-header">
                    <h3>🕐 Reportes Recientes</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo de Reporte</th>
                                    <th>Período</th>
                                    <th>Usuario</th>
                                    <th>Formato</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2024-01-21 10:30</td>
                                    <td>Balance General</td>
                                    <td>Enero 2024</td>
                                    <td>Juan Pérez</td>
                                    <td><span class="badge badge-info">PDF</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-icon" title="Ver">👁️</button>
                                        <button class="btn btn-sm btn-icon" title="Descargar">📥</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>2024-01-20 15:45</td>
                                    <td>Estado de Resultados</td>
                                    <td>Q4 2023</td>
                                    <td>María García</td>
                                    <td><span class="badge badge-success">Excel</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-icon" title="Ver">👁️</button>
                                        <button class="btn btn-sm btn-icon" title="Descargar">📥</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>2024-01-19 09:00</td>
                                    <td>Libro Mayor</td>
                                    <td>Diciembre 2023</td>
                                    <td>Carlos López</td>
                                    <td><span class="badge badge-secondary">CSV</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-icon" title="Ver">👁️</button>
                                        <button class="btn btn-sm btn-icon" title="Descargar">📥</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Schedule Report Modal -->
    <div class="modal" id="scheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⏰ Programar Reporte</h3>
                <button class="close-modal" onclick="closeScheduleModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label>Tipo de Reporte</label>
                        <select class="form-control" id="scheduleReportType">
                            <option value="">Seleccionar...</option>
                            <option value="balance_general">Balance General</option>
                            <option value="estado_resultados">Estado de Resultados</option>
                            <option value="libro_diario">Libro Diario</option>
                            <option value="libro_mayor">Libro Mayor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Frecuencia</label>
                        <select class="form-control" id="scheduleFrequency">
                            <option value="daily">Diario</option>
                            <option value="weekly">Semanal</option>
                            <option value="monthly">Mensual</option>
                            <option value="quarterly">Trimestral</option>
                            <option value="yearly">Anual</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Hora de Envío</label>
                        <input type="time" class="form-control" id="scheduleTime" value="08:00">
                    </div>
                    <div class="form-group">
                        <label>Destinatarios</label>
                        <input type="email" class="form-control" id="scheduleEmails" 
                               placeholder="email1@ejemplo.com, email2@ejemplo.com">
                    </div>
                    <div class="form-group">
                        <label>Formato</label>
                        <select class="form-control" id="scheduleFormat">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="both">PDF y Excel</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeScheduleModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="saveSchedule()">Guardar Programación</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Generando reporte...</p>
    </div>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/api_service.js"></script>
    <script src="js/sidebar.js"></script>
    <script src="js/reports.js"></script>
</body>
</html>