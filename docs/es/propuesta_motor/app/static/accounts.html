<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan de Cuentas - Motor Contable</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f0f2f5;
            color: #262626;
        }

        .header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1890ff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-title {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: #262626;
        }

        .navigation {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .nav-link {
            padding: 0.75rem 1.5rem;
            background: white;
            color: #1890ff;
            text-decoration: none;
            border-radius: 6px;
            border: 1px solid #d9d9d9;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: #f0f2f5;
        }

        .nav-link.active {
            background: #1890ff;
            color: white;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #096dd9;
        }

        .btn.secondary {
            background: #f0f0f0;
            color: #262626;
        }

        .btn.secondary:hover {
            background: #d9d9d9;
        }

        .filters {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .accounts-tree {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .account-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s ease;
        }

        .account-item:hover {
            background: #f0f2f5;
        }

        .account-item:last-child {
            border-bottom: none;
        }

        .account-level {
            margin-right: 1rem;
            width: 40px;
            text-align: center;
            font-size: 0.75rem;
            color: #8c8c8c;
        }

        .account-code {
            font-family: 'Monaco', 'Consolas', monospace;
            font-weight: 600;
            width: 120px;
            margin-right: 1rem;
        }

        .account-name {
            flex: 1;
            margin-right: 1rem;
        }

        .account-type {
            width: 100px;
            text-align: center;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .account-type.asset {
            background: #f6ffed;
            color: #52c41a;
        }

        .account-type.liability {
            background: #fff2f0;
            color: #cf1322;
        }

        .account-type.equity {
            background: #f0f5ff;
            color: #1890ff;
        }

        .account-type.revenue {
            background: #fff7e6;
            color: #fa8c16;
        }

        .account-type.expense {
            background: #fef6f6;
            color: #f5222d;
        }

        .account-balance {
            width: 120px;
            text-align: right;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.875rem;
        }

        .account-actions {
            width: 100px;
            text-align: center;
        }

        .action-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            margin: 0 0.25rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #8c8c8c;
        }

        .error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #cf1322;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .level-1 {
            font-weight: 600;
            background: #fafafa;
        }

        .level-2 {
            padding-left: 2rem;
            font-weight: 500;
        }

        .level-3 {
            padding-left: 4rem;
        }

        .level-4 {
            padding-left: 6rem;
        }

        .level-5 {
            padding-left: 8rem;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-item {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1890ff;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #8c8c8c;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">üè¢ Motor Contable</div>
        <div>
            <a href="/" class="btn secondary">‚Üê Inicio</a>
        </div>
    </header>

    <div class="container">
        <h1 class="page-title">Plan de Cuentas</h1>

        <div class="navigation">
            <a href="/dashboard.html" class="nav-link">üìä Dashboard</a>
            <a href="/vouchers.html" class="nav-link">üìÑ Comprobantes</a>
            <a href="/accounts.html" class="nav-link active">üè¶ Cuentas</a>
            <a href="/swagger/" class="nav-link">üìö API Docs</a>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalAccounts">-</div>
                <div class="stat-label">Cuentas Totales</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="activeAccounts">-</div>
                <div class="stat-label">Cuentas Activas</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="movementAccounts">-</div>
                <div class="stat-label">Acepta Movimiento</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="assetAccounts">-</div>
                <div class="stat-label">Activos</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="liabilityAccounts">-</div>
                <div class="stat-label">Pasivos</div>
            </div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3>Plan √önico de Cuentas (PUC)</h3>
                <div>
                    <button onclick="refreshData()" class="btn secondary">
                        üîÑ Actualizar
                    </button>
                    <button onclick="exportAccounts()" class="btn">
                        üìã Exportar
                    </button>
                </div>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <input type="text" id="searchInput" placeholder="Buscar por c√≥digo o nombre de cuenta...">
                </div>
                <div class="filter-group">
                    <select id="typeFilter">
                        <option value="">Todos los tipos</option>
                        <option value="ASSET">Activos</option>
                        <option value="LIABILITY">Pasivos</option>
                        <option value="EQUITY">Patrimonio</option>
                        <option value="REVENUE">Ingresos</option>
                        <option value="EXPENSE">Gastos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select id="levelFilter">
                        <option value="">Todos los niveles</option>
                        <option value="1">Nivel 1 - Clase</option>
                        <option value="2">Nivel 2 - Grupo</option>
                        <option value="3">Nivel 3 - Cuenta</option>
                        <option value="4">Nivel 4 - Subcuenta</option>
                        <option value="5">Nivel 5 - Auxiliar</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select id="movementFilter">
                        <option value="">Movimiento</option>
                        <option value="true">Acepta Movimiento</option>
                        <option value="false">No Acepta Movimiento</option>
                    </select>
                </div>
            </div>

            <div id="accountsContainer" class="loading">
                Cargando plan de cuentas...
            </div>
        </div>
    </div>

    <script>
        let allAccounts = [];
        let filteredAccounts = [];

        // Cargar cuentas desde la API
        async function loadAccounts() {
            try {
                // Por ahora mostrar datos est√°ticos del PUC colombiano hasta que la API est√© implementada
                // TODO: En el futuro, esto se conectar√° a /api/v1/accounts
                const mockAccounts = [
                    { id: '1', code: '1', name: 'ACTIVO', account_type: 'ASSET', level: 1, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '2', code: '11', name: 'DISPONIBLE', account_type: 'ASSET', level: 2, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '3', code: '1105', name: 'CAJA', account_type: 'ASSET', level: 3, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '4', code: '110505', name: 'CAJA GENERAL', account_type: 'ASSET', level: 4, accepts_movement: true, is_active: true, current_balance: 0 },
                    { id: '5', code: '1110', name: 'BANCOS', account_type: 'ASSET', level: 3, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '6', code: '111005', name: 'BANCO BOGOT√Å', account_type: 'ASSET', level: 4, accepts_movement: true, is_active: true, current_balance: 0 },
                    
                    { id: '7', code: '2', name: 'PASIVO', account_type: 'LIABILITY', level: 1, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '8', code: '24', name: 'IMPUESTOS GRAV√ÅMENES Y TASAS', account_type: 'LIABILITY', level: 2, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '9', code: '2408', name: 'IMPUESTO A LAS VENTAS POR PAGAR', account_type: 'LIABILITY', level: 3, accepts_movement: true, is_active: true, current_balance: 0 },
                    
                    { id: '10', code: '3', name: 'PATRIMONIO', account_type: 'EQUITY', level: 1, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '11', code: '31', name: 'CAPITAL SOCIAL', account_type: 'EQUITY', level: 2, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '12', code: '3105', name: 'CAPITAL SUSCRITO Y PAGADO', account_type: 'EQUITY', level: 3, accepts_movement: true, is_active: true, current_balance: 0 },
                    
                    { id: '13', code: '4', name: 'INGRESOS', account_type: 'REVENUE', level: 1, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '14', code: '41', name: 'OPERACIONALES', account_type: 'REVENUE', level: 2, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '15', code: '4135', name: 'COMERCIO AL POR MAYOR Y AL POR MENOR', account_type: 'REVENUE', level: 3, accepts_movement: true, is_active: true, current_balance: 0 },
                    
                    { id: '16', code: '5', name: 'GASTOS', account_type: 'EXPENSE', level: 1, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '17', code: '51', name: 'OPERACIONALES DE ADMINISTRACI√ìN', account_type: 'EXPENSE', level: 2, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '18', code: '5105', name: 'GASTOS DE PERSONAL', account_type: 'EXPENSE', level: 3, accepts_movement: false, is_active: true, current_balance: 0 },
                    { id: '19', code: '510506', name: 'SUELDOS', account_type: 'EXPENSE', level: 4, accepts_movement: true, is_active: true, current_balance: 0 },
                ];

                allAccounts = mockAccounts;
                filteredAccounts = [...allAccounts];
                
                updateStats();
                displayAccounts();
                
            } catch (error) {
                console.error('Error cargando cuentas:', error);
                document.getElementById('accountsContainer').innerHTML = `
                    <div class="error">
                        Error cargando el plan de cuentas: ${error.message}
                        <br><br>
                        <button onclick="loadAccounts()" class="btn">üîÑ Reintentar</button>
                    </div>
                `;
            }
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            const total = allAccounts.length;
            const active = allAccounts.filter(a => a.is_active).length;
            const movement = allAccounts.filter(a => a.accepts_movement).length;
            const assets = allAccounts.filter(a => a.account_type === 'ASSET').length;
            const liabilities = allAccounts.filter(a => a.account_type === 'LIABILITY').length;

            document.getElementById('totalAccounts').textContent = total;
            document.getElementById('activeAccounts').textContent = active;
            document.getElementById('movementAccounts').textContent = movement;
            document.getElementById('assetAccounts').textContent = assets;
            document.getElementById('liabilityAccounts').textContent = liabilities;
        }

        // Mostrar cuentas
        function displayAccounts() {
            const container = document.getElementById('accountsContainer');
            
            if (filteredAccounts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #8c8c8c;">
                        No se encontraron cuentas que coincidan con los filtros.
                        <br><br>
                        <button onclick="clearFilters()" class="btn secondary">Limpiar Filtros</button>
                    </div>
                `;
                return;
            }

            let html = '<div class="accounts-tree">';
            
            filteredAccounts.forEach(account => {
                const typeClass = account.account_type.toLowerCase();
                const levelClass = `level-${account.level}`;
                const balance = (account.current_balance || 0).toLocaleString('es-CO');
                
                html += `
                    <div class="account-item ${levelClass}">
                        <div class="account-level">${account.level}</div>
                        <div class="account-code">${account.code}</div>
                        <div class="account-name">${account.name}</div>
                        <div class="account-type ${typeClass}">${getTypeText(account.account_type)}</div>
                        <div class="account-balance">$${balance}</div>
                        <div class="account-actions">
                            <button onclick="viewAccount('${account.id}')" class="btn action-btn secondary">
                                üëÅÔ∏è Ver
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Obtener texto del tipo de cuenta
        function getTypeText(type) {
            const types = {
                'ASSET': 'Activo',
                'LIABILITY': 'Pasivo', 
                'EQUITY': 'Patrimonio',
                'REVENUE': 'Ingreso',
                'EXPENSE': 'Gasto'
            };
            return types[type] || type;
        }

        // Filtrar cuentas
        function filterAccounts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const levelFilter = document.getElementById('levelFilter').value;
            const movementFilter = document.getElementById('movementFilter').value;

            filteredAccounts = allAccounts.filter(account => {
                // Filtro de b√∫squeda
                const matchesSearch = !searchTerm || 
                    account.code.toLowerCase().includes(searchTerm) ||
                    account.name.toLowerCase().includes(searchTerm);

                // Filtro de tipo
                const matchesType = !typeFilter || account.account_type === typeFilter;

                // Filtro de nivel
                const matchesLevel = !levelFilter || account.level.toString() === levelFilter;

                // Filtro de movimiento
                const matchesMovement = !movementFilter || 
                    account.accepts_movement.toString() === movementFilter;

                return matchesSearch && matchesType && matchesLevel && matchesMovement;
            });

            displayAccounts();
        }

        // Limpiar filtros
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('levelFilter').value = '';
            document.getElementById('movementFilter').value = '';
            
            filteredAccounts = [...allAccounts];
            displayAccounts();
        }

        // Ver detalle de cuenta
        function viewAccount(accountId) {
            const account = allAccounts.find(a => a.id === accountId);
            if (account) {
                alert(`Cuenta: ${account.code} - ${account.name}\nTipo: ${getTypeText(account.account_type)}\nNivel: ${account.level}\nAcepta Movimiento: ${account.accepts_movement ? 'S√≠' : 'No'}`);
                
                // TODO: En el futuro, esto abrir√≠a un modal con el detalle completo
                // incluyendo movimientos, balances hist√≥ricos, etc.
            }
        }

        // Exportar cuentas
        function exportAccounts() {
            // TODO: En el futuro, esto generar√≠a un archivo Excel o PDF
            // con el plan de cuentas completo
            alert('Funcionalidad de exportaci√≥n ser√° implementada en la siguiente fase.');
        }

        // Refrescar datos
        function refreshData() {
            document.getElementById('accountsContainer').innerHTML = '<div class="loading">Cargando plan de cuentas...</div>';
            setTimeout(loadAccounts, 500); // Simular carga
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadAccounts();
            
            // Configurar filtros
            document.getElementById('searchInput').addEventListener('input', filterAccounts);
            document.getElementById('typeFilter').addEventListener('change', filterAccounts);
            document.getElementById('levelFilter').addEventListener('change', filterAccounts);
            document.getElementById('movementFilter').addEventListener('change', filterAccounts);
            
            // TODO: En el futuro, aqu√≠ se usar√≠a go-dsl para:
            // 1. Generar din√°micamente el plan de cuentas seg√∫n normativas locales
            // 2. Aplicar reglas de validaci√≥n espec√≠ficas por sector
            // 3. Calcular autom√°ticamente balances y clasificaciones
            // 4. Generar reportes personalizados seg√∫n configuraciones
        });
    </script>
</body>
</html>