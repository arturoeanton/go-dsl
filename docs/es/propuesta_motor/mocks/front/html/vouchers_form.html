<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Comprobante - Motor Contable</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/components.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <button class="menu-toggle" id="menuToggle">‚ò∞</button>
            <div class="navbar-brand">
                <h1>Motor Contable</h1>
            </div>
            <div class="navbar-actions">
                <div class="search-box">
                    <input type="text" placeholder="Buscar..." id="searchInput">
                    <button type="button" class="search-btn">üîç</button>
                </div>
                <div class="user-menu">
                    <img src="../img/avatar.png" alt="Usuario" class="user-avatar">
                    <span>Juan P√©rez</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="dashboard.html"><span class="menu-icon">üìä</span><span class="menu-text">Dashboard</span></a></li>
                    <li class="active"><a href="vouchers_list.html"><span class="menu-icon">üìÑ</span><span class="menu-text">Comprobantes</span></a></li>
                    <li><a href="journal_entries.html"><span class="menu-icon">üìö</span><span class="menu-text">Asientos</span></a></li>
                    <li><a href="accounts_chart.html"><span class="menu-icon">üè¶</span><span class="menu-text">Plan de Cuentas</span></a></li>
                    <li><a href="reports.html"><span class="menu-icon">üìà</span><span class="menu-text">Reportes</span></a></li>
                    <li><a href="dsl_editor.html"><span class="menu-icon">‚öôÔ∏è</span><span class="menu-text">Reglas DSL</span></a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h2>Crear Comprobante</h2>
                <button class="btn btn-secondary" onclick="window.location.href='vouchers_list.html'">
                    ‚Üê Volver al Listado
                </button>
            </div>

            <!-- Form Content -->
            <form id="voucherForm">
                <!-- Basic Info Card -->
                <div class="card">
                    <div class="card-header">
                        <h3>üìÑ Informaci√≥n B√°sica</h3>
                    </div>
                    <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="voucherType">Tipo de Comprobante *</label>
                                    <select id="voucherType" name="voucherType" class="form-control" required>
                                        <option value="">Seleccione...</option>
                                        <option value="invoice_sale">Factura de Venta</option>
                                        <option value="invoice_purchase">Factura de Compra</option>
                                        <option value="receipt">Recibo de Caja</option>
                                        <option value="payment">Comprobante de Egreso</option>
                                        <option value="debit_note">Nota D√©bito</option>
                                        <option value="credit_note">Nota Cr√©dito</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="voucherNumber">N√∫mero *</label>
                                    <input type="text" id="voucherNumber" name="voucherNumber" 
                                           class="form-control" placeholder="FV-001-2024" required>
                                </div>

                                <div class="form-group">
                                    <label for="voucherDate">Fecha *</label>
                                    <input type="date" id="voucherDate" name="voucherDate" 
                                           class="form-control" value="2024-01-21" required>
                                </div>

                                <div class="form-group">
                                    <label for="currency">Moneda</label>
                                    <select id="currency" name="currency" class="form-control">
                                        <option value="COP">COP - Peso Colombiano</option>
                                        <option value="USD">USD - D√≥lar</option>
                                        <option value="EUR">EUR - Euro</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group full-width">
                                <label for="description">Descripci√≥n *</label>
                                <textarea id="description" name="description" rows="2" 
                                          class="form-control" placeholder="Descripci√≥n del comprobante..." required></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Customer/Supplier Info -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üë• Tercero</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="taxId">NIT/C√©dula *</label>
                                    <div style="display: flex; gap: 5px;">
                                        <input type="text" id="taxId" name="taxId" 
                                               class="form-control" placeholder="900123456-7" required>
                                        <button type="button" class="btn btn-secondary" onclick="searchThirdParty()">üîç</button>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="customerName">Nombre/Raz√≥n Social *</label>
                                    <input type="text" id="customerName" name="customerName" 
                                           class="form-control" placeholder="Cliente Ejemplo S.A.S." required>
                                </div>

                                <div class="form-group">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" name="email" 
                                           class="form-control" placeholder="contacto@cliente.com">
                                </div>

                                <div class="form-group">
                                    <label for="phone">Tel√©fono</label>
                                    <input type="tel" id="phone" name="phone" 
                                           class="form-control" placeholder="+57 300 123 4567">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Line Items -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üìã Detalle de Items</h3>
                            <button type="button" class="btn btn-primary btn-sm" onclick="addLineItem()">
                                ‚ûï Agregar L√≠nea
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th style="width: 30%">Descripci√≥n</th>
                                            <th style="width: 10%">Cantidad</th>
                                            <th style="width: 15%">Precio Unit.</th>
                                            <th style="width: 10%">Desc %</th>
                                            <th style="width: 10%">IVA %</th>
                                            <th style="width: 15%">Total</th>
                                            <th style="width: 10%">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="lineItems">
                                        <tr class="line-item">
                                            <td>
                                                <input type="text" name="item_description[]" 
                                                       class="form-control form-control-sm"
                                                       placeholder="Descripci√≥n del producto/servicio" required>
                                            </td>
                                            <td>
                                                <input type="number" name="item_quantity[]" 
                                                       class="form-control form-control-sm text-right"
                                                       value="1" min="1" step="0.01" required>
                                            </td>
                                            <td>
                                                <input type="number" name="item_price[]" 
                                                       class="form-control form-control-sm text-right"
                                                       value="0" min="0" step="0.01" required>
                                            </td>
                                            <td>
                                                <input type="number" name="item_discount[]" 
                                                       class="form-control form-control-sm text-right"
                                                       value="0" min="0" max="100" step="0.01">
                                            </td>
                                            <td>
                                                <select name="item_tax[]" class="form-control form-control-sm">
                                                    <option value="0">0%</option>
                                                    <option value="5">5%</option>
                                                    <option value="19" selected>19%</option>
                                                </select>
                                            </td>
                                            <td class="text-right">
                                                <span class="item-total">$ 0</span>
                                            </td>
                                            <td class="text-center">
                                                <button type="button" class="btn btn-sm btn-danger" onclick="removeLineItem(this)">
                                                    üóëÔ∏è
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Totals -->
                    <div class="card">
                        <div class="card-header">
                            <h3>üí∞ Totales</h3>
                        </div>
                        <div class="card-body">
                            <div style="max-width: 400px; margin-left: auto;">
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                    <span>Subtotal:</span>
                                    <span id="subtotal">$ 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                    <span>Descuentos:</span>
                                    <span id="discounts">$ 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                    <span>IVA 19%:</span>
                                    <span id="tax19">$ 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                    <span>IVA 5%:</span>
                                    <span id="tax5">$ 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                    <span>Retenciones:</span>
                                    <span id="retentions">$ 0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 12px 0; font-size: 1.2rem; font-weight: bold; border-top: 2px solid #ddd;">
                                    <span>Total:</span>
                                    <span id="totalAmount">$ 0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                            üíæ Guardar Borrador
                        </button>
                        <button type="submit" class="btn btn-primary">
                            ‚úÖ Crear y Procesar
                        </button>
                    </div>
                </form>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../js/utils.js"></script>
    <script src="../js/api_service.js"></script>
    <script src="../js/vouchers.js"></script>
</body>
</html>